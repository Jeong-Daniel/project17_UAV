sudo apt-get update
sudo apt-get upgrade
sudo reboot

sudo apt-get install build-essential cmake
sudo apt-get install libjpeg-dev libtiff5-dev libjasper-dev libpng12-dev
sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev libxvidcore-dev libx264-dev libxine2-dev
sudo apt-get install libv4l-dev v4l-utils
sudo apt-get install libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev gstreamer1.0-plugins-good gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly
sudo apt-get install libgtk2.0-dev

sudo apt-get install mesa-utils libgl1-mesa-dri libgtkgl2.0-dev libgtkglext1-dev   
<For OpenGL

sudo apt-get install libatlas-base-dev gfortran libeigen3-dev

sudo apt-get install python2.7-dev python3-dev python-numpy python3-numpy

pi@raspberrypi:~ $ mkdir opencv
pi@raspberrypi:~ $ cd opencv
pi@raspberrypi:~/opencv $

$ wget -O opencv.zip https://github.com/opencv/opencv/archive/4.5.1.zip
$ unzip opencv.zip

$ wget -O opencv_contrib.zip https://github.com/opencv/opencv_contrib/archive/4.5.1.zip
$ unzip opencv_contrib.zip

pi@raspberrypi:~/opencv $  cd opencv-4.5.1

pi@raspberrypi:~/opencv/opencv-4.5.1 $  mkdir build
pi@raspberrypi:~/opencv/opencv-4.5.1 $  cd build
pi@raspberrypi:~/opencv/opencv-4.5.1/build $  

-D OPENCV_EXTRA_MODULES_PATH=../../opencv_contrib-4.5.1/modules 

cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local -D WITH_TBB=OFF -D WITH_IPP=OFF -D WITH_1394=OFF -D BUILD_WITH_DEBUG_INFO=OFF -D BUILD_DOCS=OFF -D INSTALL_C_EXAMPLES=ON -D INSTALL_PYTHON_EXAMPLES=ON -D BUILD_EXAMPLES=OFF -D BUILD_TESTS=OFF -D BUILD_PERF_TESTS=OFF -D ENABLE_NEON=ON -D ENABLE_VFPV3=ON -D WITH_QT=OFF -D WITH_GTK=ON -D WITH_OPENGL=ON -D OPENCV_ENABLE_NONFREE=ON -D OPENCV_EXTRA_MODULES_PATH=../../opencv_contrib-4.5.1/modules -D WITH_V4L=ON -D WITH_FFMPEG=ON -D WITH_XINE=ON -D ENABLE_PRECOMPILED_HEADERS=OFF -D BUILD_NEW_PYTHON_SUPPORT=ON -D OPENCV_GENERATE_PKGCONFIG=ON ../

/etc/dphys-swapfile 파일을 열어서 

 

$ sudo nano /etc/dphys-swapfile




CONF_SWAPSIZE  변수값을 100에서 2048로 수정합니다.

 

# set size to absolute value, leaving empty (default) then uses computed value

#   you most likely don't want this, unless you have an special disk situation

# CONF_SWAPSIZE=100

CONF_SWAPSIZE=2048




스왑 서비스 재시작하여 변경된 설정을 반영시켜주면 스왑 크기가 대략 20배가 됩니다. 

 

pi@raspberrypi:~/opencv/opencv-4.5.1/build $ free

              total        used        free      shared  buff/cache   available

              total        used        free      shared  buff/cache   available

Mem:        3919136       62104     2461072        8648     1395960     3693744

Swap:        102396           0      102396

100 메가 였던 Swap이




pi@raspberrypi:~/opencv/opencv-4.5.1/build $ sudo /etc/init.d/dphys-swapfile restart

[ ok ] Restarting dphys-swapfile (via systemctl): dphys-swapfile.service.

 

pi@raspberrypi:~/opencv/opencv-4.5.1/build $ free

              total        used        free      shared  buff/cache   available

Mem:        3919136       64196     2457588        8648     1397352     3691628

Swap:       2097148           0     2097148

2048메가로 바뀝니다. 




4-10. 이제 make 명령을 사용하여 컴파일을 시작합니다.  -j4 옵션을 주고 우선 진행합니다.   

 

pi@raspberrypi:~/opencv/opencv-4.5.1/build $ time make -j4



4-11. 이제 컴파일 결과물을 설치합니다.

 

pi@raspberrypi:~/opencv/opencv-4.5.1/build $ sudo make install




샘플 코드들은 /usr/local/share/opencv4/samples/ 위치에 복사됩니다. 




 4-12. opencv  라이브러리를 찾을 수 있도록 다음 명령을 실행합니다.

 

pi@raspberrypi:~/opencv/opencv-4.5.1/build $ sudo ldconfig




4-13. /etc/dphys-swapfile 파일을 열어서 

 

$ sudo nano /etc/dphys-swapfile




CONF_SWAPSIZE  변수값을 다시 100으로 수정합니다.

 

# set size to absolute value, leaving empty (default) then uses computed value

#   you most likely don't want this, unless you have an special disk situation

CONF_SWAPSIZE=100





스왑 서비스 재시작하여 변경된 설정을 반영시켜주면 스왑 크기가 원래대로 돌아옵니다. 

 

pi@raspberrypi:~/opencv/opencv-4.5.1/build $ sudo /etc/init.d/dphys-swapfile restart

[ ok ] Restarting dphys-swapfile (via systemctl): dphys-swapfile.service.




pi@raspberrypi:~/opencv/opencv-4.5.1/build $ free

